{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="text-gray-600 body-font overflow-hidden">
    <div class="container px-5 py-24 mx-auto">
        <div class="lg:w-4/5 mx-auto">

            <h1 class="text-gray-900 text-3xl title-font font-medium mb-6">All Agents - Statistics</h1>

            <!-- Date Filter Form -->
            <form method="get" class="mb-6">
                <div class="flex flex-wrap items-center space-x-4">
                    <div>
                        {{ form.start_datetime.label_tag }}<br>
                        {{ form.start_datetime }}
                    </div>
                    <div>
                        {{ form.end_datetime.label_tag }}<br>
                        {{ form.end_datetime }}
                    </div>
                    <div class="mt-4">
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Filter</button>
                    </div>
                </div>
            </form>

            <!-- Statistics Overview -->
            <div class="mb-6">
                <h2 class="text-lg font-medium text-gray-700 title-font mb-4">Overview (All Agents)</h2>
                <ul class="list-disc pl-5 text-gray-700">
                    <li><strong>Total Orders:</strong> {{ stats.order_count }}</li>
                    <li><strong>Total Order Value:</strong> {{ stats.total_value|floatformat:2 }}</li>
                    <li><strong>Average Order Value:</strong> {{ stats.average_order_value|floatformat:2 }}</li>
                    <li><strong>Converted Leads (Sale):</strong> {{ stats.sale }}</li>
                    <li><strong>Converted Leads (No Sale):</strong> {{ stats.no_sale }}</li>
                </ul>
            </div>

            <!-- Lead Conversion Chart -->
            <div class="mb-10">
                <h2 class="text-lg font-medium text-gray-700 title-font mb-4">Lead Conversion (All Agents)</h2>
                <canvas id="leadConversionChart" width="400" height="200"></canvas>
            </div>

            <!-- Order Statistics Chart -->
            <div class="mb-10">
                <h2 class="text-lg font-medium text-gray-700 title-font mb-4">Order Statistics (All Agents)</h2>
                <canvas id="orderStatsChart" width="400" height="200"></canvas>
            </div>

            <!-- Daily Order Count Chart -->
            <div class="mb-10">
                <h2 class="text-lg font-medium text-gray-700 title-font mb-4">Daily Order Count (Last 7 Days, All Agents)</h2>
                <canvas id="dailyOrdersChart" width="400" height="200"></canvas>
            </div>

            <!-- Monthly Revenue Trend Chart -->
            <div class="mb-10">
                <h2 class="text-lg font-medium text-gray-700 title-font mb-4">Monthly Revenue Trend (Last 6 Months, All Agents)</h2>
                <canvas id="monthlyRevenueChart" width="400" height="200"></canvas>
            </div>

        </div>
    </div>
</section>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Reuse the same JS file from single-agent view -->
<script src="{% static 'js/agent_stats.js' %}"></script>

<!-- Embed aggregated stats data just like the single-agent template -->
<div id="chart-data"
     data-lead-stats='{"sale": {{ stats.sale }}, "no_sale": {{ stats.no_sale }}}'
     data-order-stats='{"order_count": {{ stats.order_count }}, "total_value": {{ stats.total_value|floatformat:2 }}, "average_value": {{ stats.average_order_value|floatformat:2 }}}'
     data-daily-orders='{{ daily_orders_data_json|safe }}'
     data-monthly-revenue='{{ monthly_revenue_data_json|safe }}'>
</div>
{% endblock content %}
